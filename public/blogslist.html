<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogs</title>
    <script src="https://kit.fontawesome.com/a05ef9628f.js" crossorigin="anonymous"></script> 
    <link
    rel="stylesheet"
    href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
  />
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/skills.css">
    <link rel="stylesheet" href="../css/blogs.css">
</head>
<body>
    <div class="navbar">
        <div class="links-cont">
            <a href="./index.html">Home</a>
            <a href="./index.html#aboutme">About me</a>
            <a href="./index.html#portfolio">Portfolio</a>
            <a href="./index.html#skills">Skills</a>
            <a href="./index.html#contactme">Contact me</a>
            <a href="./blogs.html" class="active-link">Blogs</a>
            <div class="moon">
                <button><i class="fa-moon uil uil-moon change-theme"></i></button>
            </div>
           <div>
            <a id="logSign" style="text-decoration: none;" href="./login.html"><button class="btn"><i class="fa fa-sign-in"></i> Login/Signup</button></a>
            <div id="profileauth" class="loggedUser">
              <div class="dropdown  ">
              <div style="display: flex;">
                <div class="imggg">
                  <img src="../images/me.png" alt="">
                </div>
                &nbsp;<p style="font-weight: bold;font-style: italic;" id="username-display"></p>
              </div>
                
                <div class="dropdown-content">
                  <a href="./userProfile.html">Your Profile</a>
                  <a href="#">Settings</a>
                <a href="#" onclick="logout()">Logout</a>
                </div>
              </div>
            </div>
           </div>
        </div>
    </div>

  
    <div class="left-side-bar">

        <div class="logo-cont">
            
        </div>

     

        <div class="bottom-line">
        </div>

    </div>

    <div class="right-cont">
        
        <!-- <div class="container" id="containerBlogs"> -->

          <div class="container" id="blogsCntainer">
          
          </div>
      
       
           

    </div>

    <div class="navbars-cont" id="menuBottom">

      <div class="top-one-social">
           <a href="./index.html#" onclick="hideMenu()">
            <div>
              <i class="fa fa-home change-theme"></i>
              <p>Home</p>
             </div>
           </a>
         <a href="./index.html#aboutme" onclick="hideMenu()">
          <div>
            <i class="fa fa-user change-theme"></i>
            <p>About me</p>
           </div>
         </a>
         <a href="./index.html#portfolio" onclick="hideMenu()">
          <div>
            <i class="change-theme fa-solid fa-diagram-project"></i>
            <p>Portfolio</p>
           </div>
         </a>
      </div>

      <div class="top-one-social">
        <a href="./blogs.html">
          <div>
            <i class="change-theme fa-solid fa-blog"></i>
            <p>Blogs</p>
           </div>
        </a>
      <a href="./index.html#skills" onclick="hideMenu()">
        <div>
          <i class="change-theme fa-solid fa-graduation-cap"></i>
          <p>Skills</p>
         </div>
      </a>
       <a href="./index.html#contactme" onclick="hideMenu()">
        <div>
          <i class="uil uil-message change-theme"></i>
          <p>Contact me</p>
         </div>
       </a>
   </div>
   <a href="./login.html" class="closeBtn" style="float: left;margin-left: 37px;margin-top: 3px;">
    <i class="fa fa-sign-in"></i> Login
    </a>
    <div class="closeBtn">
      <!-- <a href="#news"><i class="fa-moon uil uil-moon change-theme"></i></a> -->
      <a onclick="hideMenu()"><i class="fa fa-close change-theme"></i></a>
    </div>
    </div>
    <div class="navbars">
      <a href="#home">
        <div class="logo-cont2">
            
        </div>
      </a>
    <div>
      <form action="">
        <a href="#news"><i class="fa-moon uil uil-moon change-theme"></i></a>
        <!-- <input type="checkbox" id="menus">
      <label for="menus">toggle</label> -->
      <a onclick="menuBottom()"><i class="fa fa-bars change-theme"></i></a>
      </form>
    </div>
    </div>
  
    </div>

    <script>
     let blogs = document.getElementsByClassName("column");

     for(let i=0; i<blogs.length; i++){
       blogs[i].addEventListener("click", (e)=>{
         window.location = "./blog-view.html"
       })
     }

     function menuBottom(){
    document.getElementById("menuBottom").style.display = "block"
  }

  
  function hideMenu(){
    document.getElementById("menuBottom").style.display = "none"
  }

  function logout(){
  localStorage.removeItem("token");
 return isLogged();
}

function isLogged(username){

 let token = localStorage.getItem("token")

 if(token){

  fetch("/info/loggedinuser", {
    method: 'GET',
    headers: {
        'Authorization': token
    }
  })
  .then((res) => res.json())
    .then((res) =>{
      if(res.username){
        document.getElementById("logSign").style.display = "none"
   document.getElementById("profileauth").style.display = "flex"
   document.getElementById("username-display").innerHTML  = res.username;
   return ;
      }else{
        document.getElementById("logSign").style.display = "block"
   document.getElementById("profileauth").style.display = "none"
      }
    });
 }if(!token){
  document.getElementById("logSign").style.display = "block"
   document.getElementById("profileauth").style.display = "none"
 }
}

window.onload = function(){
  isLogged('')

  fetch("/blogs", {
    method: 'GET'
  })
  .then((res) => res.json())  
    .then((blogs) =>{
          for(let i=0; i<blogs.length; i++){
           document.getElementById("blogsCntainer").innerHTML += `
           <div class="card" style="cursor: pointer;" onclick="window.location = './oneBlog.html?id=${blogs[i]?._id}'">
              <div class="card-header">
                <img src="${blogs[i].fileUrl}" alt="" />
              </div>
              <div class="card-body">
                <span class="tag tag-teal">Technology</span>
                <h4> ${blogs[i].title}</h4>
                <p class='texts'>
                  ${blogs[i].text?.length>120 ? blogs[i].text?.trim().slice(0,120)+"..." : blogs[i].text}
                </p>
                <div class="user">
                  <img src="../images/pic.jpg" alt="" class="img-ppp" />
                  <div class="user-info">
                    <h5>Igihozo colombe</h5>
                    <small>${new Date(blogs[i].createdAt).toLocaleDateString()}</small>
                  </div>
                </div>
              </div>
            </div>
           `
          }
    })
}

    </script>
</body>
</html>